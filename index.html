
<div style="margin-bottom: 5px;">
    <button id="fileOpener">📂 Open file</button>
    <button id="fileSaver">💾 Save file</button>
</div>
<div id="editor">
    <text-editor></text-editor>
</div>
<button id="runCode">▶️ Run code</button>
<strong>Output:</strong>
<pre id="script-output"></pre>

<br><br><br>

<div style="border: 1px solid black;">
    <button id="outputgetter">Get javascript code</button>
    <pre id="output"></pre>
</div>
<br>
<div style="border: 1px solid black;">
    <button id="runner">Run javascript code</button>
    <pre id="runout"></pre>
</div>
<br>
<div style="border: 1px solid black;">
    <button id="sourcegetter">Load editor from javascript code</button>
    <div id="source"></div>
</div>

<script type="module">
    import { MathEditorElement, TextEditorElement } from "./editor.js";
    import { stringToEditor } from "./string_to_editor.js";

    //https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API
    // store a reference to our file handle
    let fileHandle;

    document.getElementById('fileOpener').addEventListener('click', () => getFile());
    document.getElementById('fileSaver').addEventListener('click', () =>
        writeFile(fileHandle, document.querySelector('#editor text-editor').getOutput())
    );
    async function getFile() {
        [fileHandle] = await showOpenFilePicker();

        if (fileHandle.kind === 'file') {
            const fileData = await fileHandle.getFile();
            const contents = await fileData.text();
            document.getElementById('editor').innerHTML = '';
            document.getElementById('editor').append(new TextEditorElement({
                code: stringToEditor(contents).output
            }));
        } else if (fileHandle.kind === 'directory') {
        }
    }
    async function writeFile(fileHandle, contents) {
        if (!fileHandle) [fileHandle] = await showSaveFilePicker();
        const writable = await fileHandle.createWritable();
        await writable.write(contents);
        await writable.close();
    }

    document.getElementById('outputgetter').addEventListener('click', () => {
        const out = document.querySelector('text-editor').getOutput();
        document.getElementById('output').textContent = out;
    })

    document.getElementById('sourcegetter').addEventListener('click', () => {
        const out = document.getElementById('output').textContent;
        document.getElementById('source').innerHTML = '';
        document.getElementById('source').append(new TextEditorElement({
            code: stringToEditor(out).output
        }));
    })

    document.getElementById('runner').addEventListener('click', () => {
        const out = document.getElementById('output').textContent;
        document.getElementById('runout').innerHTML = eval(out);
    })
    document.getElementById('runCode').addEventListener('click', () => {
        const out = document.querySelector('text-editor').getOutput();
        eval(out);
    })

    function output(value) {
        document.getElementById('script-output').innerText = JSON.stringify(value);
    };
</script>

<style>
    body {
        font-size: 26px;
    }
</style>
