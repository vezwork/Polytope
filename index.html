

<text-editor></text-editor>
<br><br>
<div style="border: 1px solid black;">
    <button id="outputgetter">Get javascript code</button>
    <pre id="output"></pre>
</div>
<br>
<div style="border: 1px solid black;">
    <button id="runner">Run javascript code</button>
    <pre id="runout"></pre>
</div>
<br>
<div style="border: 1px solid black;">
    <button id="sourcegetter">Load editor from javascript code</button>
    <div id="source"></div>
</div>

<br>
<div style="border: 1px solid black;">
    <button id="fileOpener">Open file</button>
    <button id="fileSaver">Save file</button>
    <div id="fileResult"><text-editor></text-editor></div>
</div>

<script type="module">
    import { MathEditorElement, TextEditorElement } from "./editor.js";
    import { stringToEditor } from "./string_to_editor.js";

    // store a reference to our file handle
    let fileHandle;

    document.getElementById('fileOpener').addEventListener('click', () => getFile());
    document.getElementById('fileSaver').addEventListener('click', () =>
        writeFile(fileHandle, document.querySelector('#fileResult text-editor').getOutput())
    );
    async function getFile() {
        [fileHandle] = await window.showOpenFilePicker();

        if (fileHandle.kind === 'file') {
            const fileData = await fileHandle.getFile();
            const contents = await fileData.text();
            document.getElementById('fileResult').innerHTML = '';
            document.getElementById('fileResult').append(new TextEditorElement({
                code: stringToEditor(contents).output
            }));
        } else if (fileHandle.kind === 'directory') {
        }
    }
    async function writeFile(fileHandle, contents) {
        if (!fileHandle) [fileHandle] = await window.showSaveFilePicker();
        const writable = await fileHandle.createWritable();
        await writable.write(contents);
        await writable.close();
    }

    document.getElementById('outputgetter').addEventListener('click', () => {
        const out = document.querySelector('text-editor').getOutput();
        document.getElementById('output').textContent = out;
    })

    document.getElementById('sourcegetter').addEventListener('click', () => {
        const out = document.getElementById('output').textContent;
        document.getElementById('source').innerHTML = '';
        document.getElementById('source').append(new TextEditorElement({
            code: stringToEditor(out).output
        }));
    })

    document.getElementById('runner').addEventListener('click', () => {
        const out = document.getElementById('output').textContent;
        document.getElementById('runout').innerHTML = eval(out);
    })
</script>

<style>
    body {
        font-size: 26px;
    }
</style>
